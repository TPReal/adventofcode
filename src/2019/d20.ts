import {log} from "../logger";

function run1() {
  interface Pos {
    readonly x: number;
    readonly y: number;
  }
  function add(a: Pos, b: Pos): Pos {
    return {x: a.x + b.x, y: a.y + b.y};
  }
  function eq(a: Pos, b: Pos) {
    return a.x === b.x && a.y === b.y;
  }
  function posKey({x, y}: Pos) {
    return 1000 * x + y;
  }
  const map = INPUT.split("\n");
  if (!map[map.length - 1])
    map.pop();
  function get({x, y}: Pos) {
    return map[y][x];
  }
  const height = map.length - 4;
  const width = map[0].length - 4;
  const thickness = map[2 + Math.floor(height / 2)].slice(2)
    .split("").findIndex(c => c !== "#" && c !== ".");
  const firstPortal = new Map<string, Pos>();
  const portalTo = new Map<number, Pos>();
  function findPortals(
    nameStart: Pos, nameDir: Pos, scanDir: Pos, nameStartToPortal: Pos, len: number) {
    for (let i = 0; i < len; i++) {
      if (get(nameStart) !== " ") {
        const name = get(nameStart) + get(add(nameStart, nameDir));
        const thisPortal = add(nameStart, nameStartToPortal);
        const otherPortal = firstPortal.get(name);
        if (otherPortal) {
          portalTo.set(posKey(thisPortal), otherPortal);
          portalTo.set(posKey(otherPortal), thisPortal);
        } else
          firstPortal.set(name, thisPortal);
      }
      nameStart = add(nameStart, scanDir);
    }
  }
  findPortals({x: 2, y: 0}, {x: 0, y: 1}, {x: 1, y: 0}, {x: 0, y: 2}, width);
  findPortals({x: 2, y: 2 + height}, {x: 0, y: 1}, {x: 1, y: 0}, {x: 0, y: -1}, width);
  findPortals({x: 2 + thickness, y: height - thickness}, {x: 0, y: 1}, {x: 1, y: 0}, {x: 0, y: 2}, width - 2 * thickness);
  findPortals({x: 2 + thickness, y: 2 + thickness}, {x: 0, y: 1}, {x: 1, y: 0}, {x: 0, y: -1}, width - 2 * thickness);
  findPortals({x: 0, y: 2}, {x: 1, y: 0}, {x: 0, y: 1}, {x: 2, y: 0}, height);
  findPortals({x: 2 + width, y: 2}, {x: 1, y: 0}, {x: 0, y: 1}, {x: -1, y: 0}, height);
  findPortals({x: width - thickness, y: 2 + thickness}, {x: 1, y: 0}, {x: 0, y: 1}, {x: 2, y: 0}, height - 2 * thickness);
  findPortals({x: 2 + thickness, y: 2 + thickness}, {x: 1, y: 0}, {x: 0, y: 1}, {x: -1, y: 0}, height - 2 * thickness);
  function assert<T>(x: T): Exclude<T, null | undefined> {
    if (!x)
      throw new Error();
    return x as Exclude<T, null | undefined>;
  }
  const start = assert(firstPortal.get("AA"));
  const target = assert(firstPortal.get("ZZ"));

  const SINE = [0, 1, 0, -1, 0];

  function neighbours(pos: Pos) {
    const {x, y} = pos;
    const result = [];
    for (let i = 0; i < 4; i++) {
      const nPos = {x: x + SINE[i], y: y + SINE[i + 1]};
      const m = get(nPos);
      if (m === ".")
        result.push(nPos);
    }
    const other = portalTo.get(posKey(pos));
    if (other)
      result.push(other);
    return result;
  }

  function countSteps() {
    const visited = new Set<number>();
    let time = 0;
    let current = [start];
    for (; ;) {
      const next = [];
      for (const c of current) {
        const key = posKey(c);
        if (visited.has(key))
          continue;
        visited.add(key);
        if (eq(c, target))
          return time;
        next.push(...neighbours(c));
      }
      if (!next.length)
        return -1;
      current = next;
      time++;
    }
  }

  log(countSteps());
}

function run2() {
  interface Vec {
    readonly x: number;
    readonly y: number;
  }
  interface Pos extends Vec {
    readonly level: number;
  }
  function add(a: Vec, b: Vec): Vec {
    return {x: a.x + b.x, y: a.y + b.y};
  }
  function eq(a: Pos, b: Pos) {
    return a.x === b.x && a.y === b.y && a.level === b.level;
  }
  function vecKey({x, y}: Vec) {
    return 1000 * x + y;
  }
  function posKey({x, y, level}: Pos) {
    return 1000000 * level + vecKey({x, y});
  }
  const map = INPUT.split("\n");
  if (!map[map.length - 1])
    map.pop();
  function get({x, y}: Vec) {
    return map[y][x];
  }
  const height = map.length - 4;
  const width = map[0].length - 4;
  const thickness = map[2 + Math.floor(height / 2)].slice(2)
    .split("").findIndex(c => c !== "#" && c !== ".");
  const firstPortal = new Map<string, Vec>();
  const portalTo = new Map<number, Pos>();
  function findPortals(
    nameStart: Vec, nameDir: Vec, scanDir: Vec, nameStartToPortal: Vec,
    len: number, toDLevel: number) {
    for (let i = 0; i < len; i++) {
      if (get(nameStart) !== " ") {
        const name = get(nameStart) + get(add(nameStart, nameDir));
        const thisPortal = add(nameStart, nameStartToPortal);
        const otherPortal = firstPortal.get(name);
        if (otherPortal) {
          firstPortal.delete(name);
          portalTo.set(vecKey(thisPortal), {...otherPortal, level: toDLevel});
          portalTo.set(vecKey(otherPortal), {...thisPortal, level: -toDLevel});
        } else
          firstPortal.set(name, thisPortal);
      }
      nameStart = add(nameStart, scanDir);
    }
  }
  findPortals({x: 2, y: 0}, {x: 0, y: 1}, {x: 1, y: 0}, {x: 0, y: 2}, width, -1);
  findPortals({x: 2, y: 2 + height}, {x: 0, y: 1}, {x: 1, y: 0}, {x: 0, y: -1}, width, -1);
  findPortals({x: 2 + thickness, y: height - thickness}, {x: 0, y: 1}, {x: 1, y: 0}, {x: 0, y: 2}, width - 2 * thickness, 1);
  findPortals({x: 2 + thickness, y: 2 + thickness}, {x: 0, y: 1}, {x: 1, y: 0}, {x: 0, y: -1}, width - 2 * thickness, 1);
  findPortals({x: 0, y: 2}, {x: 1, y: 0}, {x: 0, y: 1}, {x: 2, y: 0}, height, -1);
  findPortals({x: 2 + width, y: 2}, {x: 1, y: 0}, {x: 0, y: 1}, {x: -1, y: 0}, height, -1);
  findPortals({x: width - thickness, y: 2 + thickness}, {x: 1, y: 0}, {x: 0, y: 1}, {x: 2, y: 0}, height - 2 * thickness, 1);
  findPortals({x: 2 + thickness, y: 2 + thickness}, {x: 1, y: 0}, {x: 0, y: 1}, {x: -1, y: 0}, height - 2 * thickness, 1);
  function assert<T>(x: T): Exclude<T, null | undefined> {
    if (!x)
      throw new Error();
    return x as Exclude<T, null | undefined>;
  }
  const start = assert({...firstPortal.get("AA"), level: 0}) as Pos;
  const target = assert({...firstPortal.get("ZZ"), level: 0}) as Pos;

  const SINE = [0, 1, 0, -1, 0];

  function neighbours(pos: Pos): Pos[] {
    const {x, y, level} = pos;
    const result = [];
    for (let i = 0; i < 4; i++) {
      const nPos = {x: x + SINE[i], y: y + SINE[i + 1], level};
      const m = get(nPos);
      if (m === ".")
        result.push(nPos);
    }
    const other = portalTo.get(vecKey(pos));
    if (other) {
      const nLevel = level + other.level;
      if (nLevel >= 0)
        result.push({...other, level: nLevel});
    }
    return result;
  }

  function countSteps() {
    const visited = new Set<number>();
    let time = 0;
    let current = [start];
    for (; ;) {
      const next = [];
      for (const c of current) {
        const key = posKey(c);
        if (visited.has(key))
          continue;
        visited.add(key);
        if (eq(c, target))
          return time;
        next.push(...neighbours(c));
      }
      if (!next.length)
        return -1;
      current = next;
      time++;
    }
  }

  log(countSteps());
}

export const run = run2;

const INPUTS = `\
         A           
         A           
  #######.#########  
  #######.........#  
  #######.#######.#  
  #######.#######.#  
  #######.#######.#  
  #####  B    ###.#  
BC...##  C    ###.#  
  ##.##       ###.#  
  ##...DE  F  ###.#  
  #####    G  ###.#  
  #########.#####.#  
DE..#######...###.#  
  #.#########.###.#  
FG..#########.....#  
  ###########.#####  
             Z       
             Z       

                   A               
                   A               
  #################.#############  
  #.#...#...................#.#.#  
  #.#.#.###.###.###.#########.#.#  
  #.#.#.......#...#.....#.#.#...#  
  #.#########.###.#####.#.#.###.#  
  #.............#.#.....#.......#  
  ###.###########.###.#####.#.#.#  
  #.....#        A   C    #.#.#.#  
  #######        S   P    #####.#  
  #.#...#                 #......VT
  #.#.#.#                 #.#####  
  #...#.#               YN....#.#  
  #.###.#                 #####.#  
DI....#.#                 #.....#  
  #####.#                 #.###.#  
ZZ......#               QG....#..AS
  ###.###                 #######  
JO..#.#.#                 #.....#  
  #.#.#.#                 ###.#.#  
  #...#..DI             BU....#..LF
  #####.#                 #.#####  
YN......#               VT..#....QG
  #.###.#                 #.###.#  
  #.#...#                 #.....#  
  ###.###    J L     J    #.#.###  
  #.....#    O F     P    #.#...#  
  #.###.#####.#.#####.#####.###.#  
  #...#.#.#...#.....#.....#.#...#  
  #.#####.###.###.#.#.#########.#  
  #...#.#.....#...#.#.#.#.....#.#  
  #.###.#####.###.###.#.#.#######  
  #.#.........#...#.............#  
  #########.###.###.#############  
           B   J   C               
           U   P   P               

             Z L X W       C                 
             Z P Q B       K                 
  ###########.#.#.#.#######.###############  
  #...#.......#.#.......#.#.......#.#.#...#  
  ###.#.#.#.#.#.#.#.###.#.#.#######.#.#.###  
  #.#...#.#.#...#.#.#...#...#...#.#.......#  
  #.###.#######.###.###.#.###.###.#.#######  
  #...#.......#.#...#...#.............#...#  
  #.#########.#######.#.#######.#######.###  
  #...#.#    F       R I       Z    #.#.#.#  
  #.###.#    D       E C       H    #.#.#.#  
  #.#...#                           #...#.#  
  #.###.#                           #.###.#  
  #.#....OA                       WB..#.#..ZH
  #.###.#                           #.#.#.#  
CJ......#                           #.....#  
  #######                           #######  
  #.#....CK                         #......IC
  #.###.#                           #.###.#  
  #.....#                           #...#.#  
  ###.###                           #.#.#.#  
XF....#.#                         RF..#.#.#  
  #####.#                           #######  
  #......CJ                       NM..#...#  
  ###.#.#                           #.###.#  
RE....#.#                           #......RF
  ###.###        X   X       L      #.#.#.#  
  #.....#        F   Q       P      #.#.#.#  
  ###.###########.###.#######.#########.###  
  #.....#...#.....#.......#...#.....#.#...#  
  #####.#.###.#######.#######.###.###.#.#.#  
  #.......#.......#.#.#.#.#...#...#...#.#.#  
  #####.###.#####.#.#.#.#.###.###.#.###.###  
  #.......#.....#.#...#...............#...#  
  #############.#.#.###.###################  
               A O F   N                     
               A A D   M                     

                                           A         D       Q       R       G       G         B                                       
                                           R         E       S       G       U       G         G                                       
  #########################################.#########.#######.#######.#######.#######.#########.#####################################  
  #.....#.....#.#.#...#.#.#.....#.#.....#.....#.....#.....#.#.....#.......#.......#.....#.....................#.................#.#.#  
  #.###.#.#.###.#.#.###.#.#.###.#.#.#######.#.###.#####.###.###.###.#.#.#######.#.#.#.#.#.#####.#.#####.#.#####.#############.###.#.#  
  #.#.#.#.#.#.......#.#.....#...#.#.#...#...#.#.#.#...#.#.....#.#...#.#.#.#.....#.#.#.#.#.#.#.#.#...#...#.......#...#...#.#.#.......#  
  ###.#.#.#####.###.#.#.###.###.#.#.###.#.###.#.#.#.#.#.#.###.#.###.#####.#####.#######.#.#.#.#.#.#####.###.#.###.###.###.#.#########  
  #.#.#.....#...#.........#.#.......#...#.#.....#...#...#.#.....#...#.....#.........#...#...#...#.#...#...#.#.......................#  
  #.#.###.#######.###.#############.###.#######.#.###.#.#.#######.###.#########.###.#.#.#.#.#.#.#####.###############.###.#.#.#.#####  
  #...#.#.....#...#...#.#...#...#.#.#.#.....#.#.#...#.#.#.....#...........#.#.....#.#.#.#.#.#.#...#.....#.#.#.#.#...#...#.#.#.#.#...#  
  #.#.#.#.#############.#.###.###.#.#.#.#####.#.#.###.###.###.#######.#####.###.#######.#.#############.#.#.#.#.###.###.#########.#.#  
  #.#.#.....#.................................#.#.#.....#.#.....#.......#.....#.#.#.....#.#...#.#.....#...#...#.....#.#.#.....#...#.#  
  #.#.###.#######.#.#####.#################.#.#.#.#######.#.###.#.#####.###.#.#.#.#####.#.#.###.###.###.#####.#.#####.###.#######.###  
  #.#.#...#.#.#.#.#.#.#.#.#.........#.#.#...#.#.#.#.......#.#...#...#.#.#...#.......#...#...#.#.#.........#.........#.....#.#.#.#...#  
  #.#####.#.#.#.#####.#.###########.#.#.###.#.#.#.#############.#.###.###.#.#########.#.###.#.#.#.#####.###.#.#.#########.#.#.#.###.#  
  #...#...#.#.....#.........................#.#.#...#.#...#.....#.....#.#.#.........#.#.#.........#.#.#.....#.#...#...............#.#  
  ###.###.#.###.#.###.###.#####.#.###.###.#.#.#.###.#.###.#####.#####.#.#######.#.#.###.#.###.###.#.#.###.###.#####.#####.#####.###.#  
  #.#.....#.....#.#...#...#.#...#.#...#.#.#.#...#.........#.......#.#...#.......#.#.#...#...#.#.......#...#.#.#.#.#.....#.....#...#.#  
  #.#.#######.###.###.#####.#######.#.#.###.#.###.#####.#.#####.###.###.#.#####.#######.#.###########.###.#.#.#.#.#.#.#############.#  
  #.....#.#...#.#.#.#...#...#.......#.#.#...#.#.....#.#.#.#...#.....#.#.#.....#...#.....#.#...#.#...#.#.....#.#.....#.#.#...#...#.#.#  
  ###.###.###.#.###.#######.#.###.#.###.#.#####.###.#.#####.###.#####.#.#.#############.#.#.###.#.#.#.###.#####.###.###.#.#####.#.#.#  
  #.....#.#.#.#.#...#.#.#.....#...#.#.........#.#...#.#.#...#.#...#.....#.........#.....#.......#.#.#.#...#.......#.#.......#.#.....#  
  #.#.###.#.#.#.###.#.#.#########.#.#.#####.###.#.###.#.#.###.#.#.#####.#.###.#######.#.#####.###.###########.#####.#.###.###.#.#.###  
  #.#...#...#...........#.......#.#.#.#.......#.#...#.....#.....#.....#.#.#.#.#.#.....#.#.#.#...........#...#.....#.#.#.#.#.....#...#  
  #####.###.#.#.###.#####.#.###.#####.###.#####.#.#.#.#.#######.###.###.#.#.###.#######.#.#.#.#.#.#.#######.#.###.#.#.#.###.#.#######  
  #...#...#...#.#.#...#...#.#.......#.#.#...#...#.#...#.....#.....#.#.#.#.#.#.........#.#.....#.#.#...#.........#.#.#.....#.#.#.#...#  
  ###.#.#.#.#.###.#.#############.#####.#.#############.#.#####.#####.#.#.#.#####.#.###.#.#.#####.#####.#.#.###.#####.#.#.###.#.#.###  
  #.#.#.#.#.#.#.....#.....................#.....#.....#.#.#.......#.#.#.#...#.#...#...#.#.#.#.#.....#...#.#.#.#...#.#.#.#.#.....#...#  
  #.#.###.#.###########.#######.#.#######.###.###.###.#.#.###.###.#.#.#.###.#.#####.#.#.#.###.#.###.###.#####.#####.#.#######.###.###  
  #.........#.#.#...#...#.......#.#...........#.#...#.#.#.#.....#.#.....#.....#.#...#...#...#.#...#.#.......#.#.#...#...#.#.........#  
  #.#######.#.#.###.###.#########.###.#.###.###.###.#.#.#######.###.#.#.#####.#.#.#######.###.#.###.#.#.#####.#.###.#.###.###.#####.#  
  #.#.#.#.#.......#.#.#.#.#.....#.#...#.#.....#.....#.#.#.#.......#.#.#.#.......#.......#.....#...#.#.#.#.#.....#.#.#.#.......#.....#  
  ###.#.#.#.#######.#.###.#.#########.###.#.#####.###.#.#.#.#.###.#.#.#.#######.#.#.###.###.#########.###.###.###.#.#.#############.#  
  #.#.#...#.#.#...#...........#.#.....#...#...#.....#...#.#.#.#...#.#.#.#.......#.#.#.....#.#...#.....#.....#...............#.#.#.#.#  
  #.#.#.#.#.#.#.#.#.#.#####.###.#.#####.#.#####.###.###.#.###.#########.#.###.#.###.#.#####.#.#####.#####.###.###############.#.#.#.#  
  #...#.#.....#.#.#.#.#.......#.#.#.....#.....#.#.....#...#.......#.....#...#.#...#.#...#.........#...#.....#.#...#.......#.....#.#.#  
  #.#.###.###.###.#######.#.###.#########.###########.#####.#########.#####.###########.#####.#####.#####.###.#.###.###########.#.#.#  
  #.#.#.#...#.#.#.....#.#.#...#.....#    V           H     W         G     D           L     G    #...#...#...#...#...#.#.#.#.......#  
  ###.#.#.#####.#.#####.###.###.#####    C           I     U         G     C           H     U    ###.#.###.#####.#.###.#.#.#.#####.#  
  #.....#.#.#...#.....#.#.#.......#.#                                                             #...............#.....#...#.#.....#  
  ###.###.#.###.#.#####.#.#.#####.#.#                                                             ###.###.#####.###.#######.###.###.#  
  #...#.#.#.#...#.#.#.......#...#.#.#                                                           BG....#.....#.#.#...#.#.#.#...#.#....YY
  ###.#.#.#.#.#.#.#.###.#####.#####.#                                                             #.#.###.###.#.###.#.#.#.#.#######.#  
  #.......#...#.....#.........#.#...#                                                             #.#...#...#.....#.#.......#...#.#.#  
  #.#####.#.#.#########.#####.#.#.#.#                                                             ###.#.#.#.#####.#.###.#.###.###.#.#  
WU..#.......#.....#...#.....#...#.#.#                                                             #...#.#.#...#.........#...........#  
  #.###.###.#.#####.###.#.#########.#                                                             #############.#####.#.#.###.#######  
  #...#.#...#...........#...#...#....SF                                                           #.#.#.....#...#.#.#.#.#...#.#.....#  
  ###.#####.#######.#######.#.#####.#                                                             #.#.#.#.#####.#.#.#####.#.###.###.#  
  #.#.#...#.#.#...#.#...............#                                                           AR..#.#.#.#.#...#...#...#.#.#...#...#  
  #.###.#####.#.#########.###########                                                             #.#.#.###.#####.###.###.#####.###.#  
  #.#...........#...#.....#.#.......#                                                             #.....#.#.#.#.....#...#.#...#...#.#  
  #.###.#######.#.###.#####.###.###.#                                                             ###.#.#.#.#.###.###.#####.#.###.#.#  
HI..#.#.......#.....#.#...#.....#....TX                                                           #.#.#.....................#.....#..LH
  #.#.###.#.###.#.#####.###.#######.#                                                             #.#############################.#.#  
  #.#.....#.#...#.........#.......#.#                                                           QS........#.#.#.#.....#.........#.#.#  
  #.#.###.#######.###.#########.#####                                                             #######.#.#.#.###.#.#.###.###.#####  
AA......#.......#.#...............#.#                                                             #.......#.#.......#.....#...#......TS
  ###.#########.#.###.#######.#.###.#                                                             #.#######.#.###.#########.###.###.#  
EZ..#.#.#.....#.#...#.#.....#.#.#...#                                                             #.#...#.......#...#.......#.....#.#  
  #.###.#.#######.#.#.#.#.#####.###.#                                                             #.#.#.#.###.#.###########.#######.#  
  #...#.....#...#.#.#.#.#.#.#.#.#.#..AE                                                           #...#...#.#.#.#.#.#...#.#...#.....#  
  ###.#.#####.#######.#.#.#.#.###.#.#                                                             #########.#####.#.#.###.###########  
  #.......#.........#.#.#.......#...#                                                           YY........#.....#.........#...#.....#  
  #.#.###.#.#.#.###.###.###.#.#.#.#.#                                                             #.###.#.#.#.###.###.#.#####.#.#.###  
  #.#...#...#.#...#.....#.#.#.#...#.#                                                             #.#...#...#.#...#...#.........#.#..VC
  ###########.#.###.#.###.###########                                                             #.#########.#.#.#####.#.#######.#.#  
IC......#...#.#.#...#.#.#...#.......#                                                             #.#.#...#.....#...#.#.#.#.#.....#.#  
  #.###.#.#.#####.#.###.#.#.#.#.#.#.#                                                             #.#.#.#############.#####.#.#####.#  
  #.#...#.#.....#.#.#.#...#...#.#.#..FR                                                           #.#.#.#.#...#.#.#...#.....#.......#  
  ###.###.#####.#####.#.#.#.###.###.#                                                             ###.#.#.#.###.#.#.#####.###########  
  #.......#.....#...#.#.#.#...#...#.#                                                             #.#...#.................#.#...#.#.#  
  #.#####.#.#######.#.###.#.#########                                                             #.#.#.#.###.#.#.#######.#.###.#.#.#  
  #...#.#.#...............#.#.#.#.#.#                                                             #...#.....#.#.#...#.....#.........#  
  #####.#.#.###.#.###.#.#.###.#.#.#.#                                                             #.#.#.#########.#.###.###.#####.#.#  
  #.#...#.#.#.#.#...#.#.#...#.....#.#                                                           OE..#.#.#.....#...#.#.#...#.....#.#.#  
  #.#.#.#####.#####.#####.###.###.#.#                                                             #.#######.#########.###.#.#.#####.#  
  #...#.#.........#.#...#.#.....#....EZ                                                           #...#...#.#.....#.....#...#.#.#....TX
  #.###.###.#.#########.###.###.###.#                                                             #######.#.#.#########.#.#####.#####  
  #.#...#...#.....#.....#.#.#...#.#.#                                                           DE..#.........#...#.........#........LR
  #.#.#.#.#####.#######.#.###.###.#.#                                                             #.#.#####.#.###.#####.#.#########.#  
SF..#.#...#...................#...#.#                                                             #.#.#.....#.....#.#.#.#...#.#.#...#  
  #####.#.#.###.#.#########.#####.###                                                             #.#.#####.###.###.#.#######.#.###.#  
  #...#.#.#.#.#.#.#.#.....#.#.......#                                                             #.#...#...#...#.#.#.#.#.#...#.....#  
  ###.#######.#####.#####.###.#####.#                                                             #.#.#######.###.#.#.#.#.#.###.#.#.#  
  #.#...#...#...#.#...#.#.......#.#..WJ                                                           #.....#...#...................#.#.#  
  #.#.#.#.###.###.###.#.###.#####.#.#                                                             #.###.###.#########################  
SA....#...#.....#.......#.#.....#...#                                                             #.#.#.#...........#.#...#...#.....#  
  #.###.#####.#######.#.#.###.#######                                                             ###.###.###.#.#.#.#.#.#.#.#.#.###.#  
  #.#.................#.............#                                                             #.........#.#.#.#.....#...#...#...#  
  #.#.#####.###.###.#####.###.#.#.###                                                             #####.#######.#####.#######.###.###  
  #.#.#.#...#.....#.#.....#...#.#...#                                                           IC..#...#...#.....#.....#.#...#......DC
  #.###.#.#####.###.#.#.#.#.#####.#.#                                                             #.###.#.###.#.#####.#.#.###.#####.#  
  #...#...#...#...#.#.#.#.#.....#.#.#                                                             #.........#.#...#.#.#.#.....#.#...#  
  #.#.#.#.#.###.#######.###.#########          T S       H   B       R         T     L            #.###.#########.#.#.###.###.#.###.#  
  #.#.#.#.#.#.......#.#.#...#.#...#.#          U A       Y   Z       G         S     R            #.#.#.......#.#.#.....#.#...#...#.#  
  ###.#####.#.#.#.#.#.#.#.#.#.#.###.###########.#.#######.###.#######.#########.#####.#############.#.###.###.#.#####.#######.#.#.###  
  #...#.#.#.#.#.#.#.#...#.#.....#.#.#...#.#.......#.#.....#.....#.#.#.#.....#...#...#...#.....#.....#.......#.....#...#.........#...#  
  ###.#.#.#.#.#####.###.#.###.#.#.#.###.#.###.###.#.###.#####.###.#.#.#.###.#.###.###.###.#.#.#.#######.#####.###.###.#.#.#.###.#.###  
  #.....#.......#.#.#.#.#.#...#.....#.........#.#.#.....#.#.#.#.....#...#.#.#.....#.......#.#.#.#.#.#.....#...#...#...#.#.#...#.#...#  
  ###.#####.#.###.###.#.###.#.#.###.###.#.###.#.#.###.###.#.#.#.###.#.###.#.#####.###.###.#.#####.#.#.#.#######.#####.#####.#.###.#.#  
  #...#.....#.........#...#.#.#.#...#...#...#...#.#...#...#.#.#.#...#.#...#.#.#...#.....#.#.........#.#...#.....#.....#.....#.#.#.#.#  
  ###.#.#.#.#.###.###.#.###.###.#####.#.###.###.#####.#.#.#.#.#.#.#.#.#####.#.#.#.#######.#.#######.#######.###.###.#.#.#.#.#.#.###.#  
  #...#.#.#.#...#...#.#.#...#...#.#.#.#...#.#.......#...#.#.....#.#.#.#.#.#.#...#...#.#...#.#.....#.#...#.....#.#.#.#.#.#.#.#...#...#  
  #.#.#.###.###.#############.#.#.#.#.#.#######.###.#.#.#.#######.#.###.#.#.###.###.#.#.###.#.###.###.###.#####.#.#####.#####.#######  
  #.#.#.#.....#.......#.......#.#.#...#...#.#...#.#.#.#.#...#.....#...#.......#.#.#.#.#.#.......#.#.....#.#.#.#.......#.#...........#  
  ###.#########.###########.#####.###.###.#.###.#.#.#.#####.#.#############.###.#.###.#####.#######.#######.#.#.###.#.###.###.#.###.#  
  #...#...#.#.#.........#.#.....#.....#.....#...#.#.#.#.....#.......#.#...#.#...........#...#.#.#.............#.#...#.#.#...#.#...#.#  
  #.#.###.#.#.#.#.#######.#.#######.###.#.#######.#.#######.###.###.#.#.###.#.#.#.###.#####.#.#.#.###.#.#######.#.#.###.#.###.#.#.###  
  #.#...#.......#.....#.......#.....#...#.#.#...#.....#.....#...#...#...#...#.#.#...#...#.#.#.......#.#.....#...#.#.#.......#.#.#...#  
  ###.#.#.#.#####.#####.#.#.#######.#######.###.#.#.#.#.###.#.###.#.#.#.#.#.#.#####.#####.#.#.#################.#########.#.#.#.#.###  
  #.#.#.#.#.#.......#...#.#...#...#...#.........#.#.#.#.#...#.#...#.#.#...#.#.#...#.....#...............#.#.#.........#...#.#.#.#...#  
  #.#####.#######.#####.#######.#.#.###########.#.#########.#######.#.###.###.#.###.#.#####.#####.#.#####.#.#####.#########.#.#####.#  
  #.........#.......#.......#.#.#...#.#.#.............#.#...#.......#.#.....#...#.#.#.#.........#.#.#.#.#.....#.#.#.#...#...#...#.#.#  
  ###.###.#####.###.#########.#####.#.#.#.#####.###.###.###.###.#.#.#.#####.#.###.#####.###.#.###.###.#.#.#####.###.#.###.###.###.#.#  
  #...#.#...#.....#.....#.#.....#...#.....#.#...#...#.#.#.#...#.#.#.#...#...#.......#...#...#...#.......#.#.............#...#.....#.#  
  ###.#.#.###.#.#.#.#.#.#.#.#.#########.#.#.#.#.###.#.#.#.#.#.#####.#.###.#####.###.#######.#######.#.###.#.#.#.###.#.#.#.###.#.#####  
  #.#.#.....#.#.#.#.#.#.#...#...#.#.....#.#...#.#.......#.#.#...#...#.#.#.#...#.#...#...#.........#.#.......#.#...#.#.#.#.#...#.#.#.#  
  #.#####.#.#.###.#####.###.###.#.#.#######.#######.#####.#.#.#####.#.#.#####.###.#.###.###.###.#####.#.#.#################.#####.#.#  
  #.......#.#.#...#...#.#...#.........#.......#.....#...#.#.#...#...#.....#.#...#.#...#.#.#...#.#.#...#.#.#...........#.#...........#  
  #.#####.#######.#.###.###.#.#.###.#############.#.#.#.###.#######.#.#####.###.###.###.#.#.#####.###.#.#.#.###.#.#.###.#####.#######  
  #...#...#.........#...#...#.#.#...#.........#...#.#.#.#.....#.....#.....#.......#.#...#.......#...#.#.#...#...#.#...#.#.....#.....#  
  #####.#######.###.###.###########.#######.#######.#.#.#.#####.#####.#####.#.###.#.###.###.#####.#.#.###.###.#######.#.#########.###  
  #.....#.......#.....#.#.......#.#.#...#.#.........#.#...#.#.....#...#...#.#.#...#.#.#...#.......#.#.#.#.#.....#.....#...........#.#  
  #.#.#######.#.#######.#######.#.#####.#.#####.#.#.#.#####.#.###.###.###.###.#.#.#.#.#.#.#.#####.#####.#.#####.#####.#.#########.#.#  
  #.#.#...#...#.....#.#...#.#.#.....#.....#...#.#.#.#.....#.#.#.....#.......#.#.#.#.#...#...#...#...#...#.#...#.#.#.............#.#.#  
  #.#####.###.###.###.#.#.#.#.#.#.#.###.###.#######.###.#.#.###.#########.###.#.###.#.#######.#######.#####.#####.###.#.###.#.#####.#  
  #...#.........#...#...#.#.....#.#.#.#.#...#.#.#.#.#.#.#.#.#.....#.........#.#.....#.........#.................#.....#.#...#.#...#.#  
  #.###.###.#.###.#########.#.#####.#.#.###.#.#.#.#.#.#.###.#.#####.#######.#.#######.###.#.###.###.#.###.#####.###.###.###.###.###.#  
  #.#...#...#.#.....#.......#...#.....................#...#...#.....#.......#.......#.#...#.......#.#...#.....#...#.#.....#.........#  
  #############################################.###.#####.###.#########.###.#######.#######.#########################################  
                                               H   B     O   F         A   Z       T       W                                           
                                               Y   Z     E   R         E   Z       U       J                                           
`.split("\n\n");

const INPUT = INPUTS[3];
